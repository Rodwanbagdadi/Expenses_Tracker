<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Expense Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; margin: 0; background-color: #1c1c1c; color: #ffffff; line-height: 1.6; }
        .container { display: flex; justify-content: space-around; margin-top: 20px; padding: 0 20px; }
        .column { width: 48%; padding: 20px; border: 1px solid #333; border-radius: 8px; background-color: #2a2a2a; box-shadow: 0 2px 5px rgba(0,0,0,0.5); }
        h1 { text-align: center; color: #4CAF50; margin-top: 20px; margin-bottom: 30px; }
        h2 { text-align: center; color: #FFA726; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        h3 { color: #B39DDB; margin-top: 20px; margin-bottom: 10px; }
        .totals { margin-top: 20px; border-top: 1px solid #333; padding-top: 15px; }
        .total-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 1.1em; }
        input[type="number"], input[type="text"] { padding: 10px; margin-bottom: 10px; border: none; border-radius: 4px; background-color: #333; color: #ffffff; width: calc(100% - 22px); display: block; box-sizing: border-box; }
        button { padding: 10px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1em; transition: background-color 0.3s ease; margin-top: 10px; }
        button:hover { background-color: #388E3C; }
        ul { list-style: none; padding: 0; margin: 0; }
        li { background-color: #333; padding: 10px; margin-bottom: 8px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; }
        li span { font-weight: bold; color: #B39DDB; }
        .payout-section { text-align: center; margin-bottom: 20px; padding: 15px; background-color: #2a2a2a; border: 1px solid #333; border-radius: 8px; margin: 20px auto; width: fit-content; }
        .payout-section label { font-size: 1.1em; margin-right: 10px; color: #B39DDB; }
        .payout-section input[type="number"] { width: 150px; display: inline-block; margin-bottom: 0; margin-right: 10px; }
        .payout-section button { margin-top: 0; }

        .savings-balance { 
            width: 96%; 
            margin: 20px auto; 
            padding: 15px; 
            border: 1px solid #333; 
            border-radius: 8px; 
            background-color: #2a2a2a; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        .savings-balance .total-row { 
            font-size: 1.2em; 
            font-weight: bold; 
            color: #4CAF50;
        }

        .month-selector {
            text-align: center;
            margin: 20px auto;
            padding: 15px;
            background-color: #2a2a2a;
            border: 1px solid #333;
            border-radius: 8px;
            width: fit-content;
        }
        .month-selector input[type="month"] {
            padding: 8px;
            margin: 0 10px;
            background-color: #333;
            color: #ffffff;
            border: none;
            border-radius: 4px;
        }
        .history-section {
            margin: 20px auto;
            padding: 20px;
            background-color: #2a2a2a;
            border: 1px solid #333;
            border-radius: 8px;
            width: 90%;
        }
        .history-section h2 {
            color: #4CAF50;
        }
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .history-table th, .history-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #333;
        }
        .history-table th {
            background-color: #333;
            color: #4CAF50;
        }
        .savings-graph {
            margin: 20px auto;
            padding: 20px;
            background-color: #2a2a2a;
            border: 1px solid #333;
            border-radius: 8px;
            width: 90%;
        }
        .savings-graph h2 {
            color: #4CAF50;
        }
        .graph-container {
            height: 300px;
            margin-top: 20px;
        }

    </style>
</head>
<body>
    <h1>Monthly Subscriptions and Expenses</h1>

    <div class="month-selector">
        <label for="month-select">Select Month:</label>
        <input type="month" id="month-input">
    </div>

    <div class="payout-section">
        <label for="salary">Monthly Payout:</label>
        <input type="number" id="salary" value="0"> <!-- Default value from image was 420, setting to 0 for fresh start -->
        <label for="extra-payout">Add Extra Payout:</label>
        <input type="number" id="extra-payout" value="0">
        <button id="add-extra-payout">Add Payout</button>
    </div>

    <div class="container">
        <div class="column">
            <h2 id="needs-heading">Needs (50%) - <span>Calculated Amount</span> <span class="currency">jd</span></h2>
            <p><em>Examples: Rent, Groceries, Utilities, Transportation, Loan Payments, Insurance</em></p>
            <ul id="needs-list">
                <!-- Needs expenses will go here -->
            </ul>
            <div>
                <h3>Add Needs Expense</h3>
                <input type="text" id="needs-expense-name" placeholder="Expense Name">
                <input type="number" id="needs-expense-amount" placeholder="Amount">
                <button id="add-needs-expense">Add Expense</button>
            </div>

            <div class="totals">
                <div class="total-row">
                    <span>Total:</span> <span id="needs-total">0<span class="currency">jd</span></span> 
                </div>
                <div class="total-row">
                    <span>Left:</span> <span id="needs-left">0<span class="currency">jd</span></span> 
                </div>
            </div>
        </div>

        <div class="column">
            <h2 id="wants-heading">Wants (30%) - <span>Calculated Amount</span> <span class="currency">jd</span></h2>
            <p><em>Examples: Entertainment, Dining Out, Hobbies, Subscriptions (streaming, gym), New Gadgets</em></p>
            <ul id="wants-list">
                <!-- Wants expenses will go here -->
            </ul>
            <div>
                <h3>Add Wants Expense</h3>
                <input type="text" id="wants-expense-name" placeholder="Expense Name">
                <input type="number" id="wants-expense-amount" placeholder="Amount">
                <button id="add-wants-expense">Add Expense</button>
            </div>

            <div class="totals">
                 <div class="total-row">
                    <span>Total:</span> <span id="wants-total">0<span class="currency">jd</span></span> 
                </div>
                <div class="total-row">
                    <span>Left:</span> <span id="wants-left">0<span class="currency">jd</span></span> 
                </div>
            </div>
        </div>
    </div>

    <div class="savings-balance">
        <div class="total-row">
            <span>Savings (20%):</span> <span id="savings-amount">0</span> <span class="currency">jd</span>
        </div>
        <div class="total-row">
            <span>Balance:</span> <span id="balance">0</span> <span class="currency">jd</span>
        </div>
    </div>

    <div class="payout-section">
        <label for="withdraw-amount">Withdraw from Savings:</label>
        <input type="number" id="withdraw-amount" value="0">
        <button id="withdraw-button">Withdraw</button>
    </div>

    <div class="savings-graph">
        <h2>Savings History</h2>
        <div class="graph-container">
            <canvas id="savingsChart"></canvas>
        </div>
    </div>

    <div class="history-section">
        <h2>Expense History</h2>
        <table class="history-table">
            <thead>
                <tr>
                    <th>Month</th>
                    <th>Total Income</th>
                    <th>Needs Total</th>
                    <th>Wants Total</th>
                    <th>Savings</th>
                </tr>
            </thead>
            <tbody id="history-body">
                <!-- History rows will be populated by JavaScript -->
            </tbody>
        </table>
    </div>

    <script>
        const salaryInput = document.getElementById('salary');
        const needsHeading = document.getElementById('needs-heading').querySelector('span');
        const wantsHeading = document.getElementById('wants-heading').querySelector('span');
        const savingsAmountSpan = document.getElementById('savings-amount');
        const balanceSpan = document.getElementById('balance');
        const extraPayoutInput = document.getElementById('extra-payout');
        const addExtraPayoutButton = document.getElementById('add-extra-payout');
        const monthInput = document.getElementById('month-input');
        const withdrawAmountInput = document.getElementById('withdraw-amount');
        const withdrawButton = document.getElementById('withdraw-button');

        // Add new variables for month management
        let currentMonth = new Date().toLocaleString('default', { month: 'long', year: 'numeric' });
        let monthlyData = {};
        let savingsChart;
        const currencySpan = document.querySelectorAll('.currency');
        const availableCurrencies = ['jd', '$', '€', '£']; // Add more currencies here

        // Initialize the month selector (now using month input)
        function initializeMonthInput() {
            // Set the initial value of the month input to the current month
            const today = new Date();
            const month = (today.getMonth() + 1).toString().padStart(2, '0');
            const year = today.getFullYear();
            monthInput.value = `${year}-${month}`;
            currentMonth = new Date(monthInput.value + '-01').toLocaleString('default', { month: 'long', year: 'numeric' });

            // Ensure current month exists in data
            if (!monthlyData[currentMonth]) {
                 monthlyData[currentMonth] = {
                    needsExpenses: [],
                    wantsExpenses: [],
                    salary: 0,
                    savingsBalance: 0, // Initialize savings balance for the month
                    currency: 'jd' // Default currency
                };
            }
            loadMonthData(); // Load data for the initially selected month
        }

        // Load data for selected month from month input
        function loadMonthData() {
            const [year, month] = monthInput.value.split('-');
            currentMonth = new Date(`${year}-${month}-01`).toLocaleString('default', { month: 'long', year: 'numeric' });

            // If the month doesn't exist in monthlyData, create it
            if (!monthlyData[currentMonth]) {
                 monthlyData[currentMonth] = {
                    needsExpenses: [],
                    wantsExpenses: [],
                    salary: 0,
                    savingsBalance: 0,
                    currency: monthlyData[Object.keys(monthlyData)[0]]?.currency || 'jd' // Use currency from first month if available, otherwise default
                };
            }

            const monthData = monthlyData[currentMonth];

            // Update salary input field
            salaryInput.value = monthData.salary || 0;
            extraPayoutInput.value = '0'; // Clear extra payout input on month change

            // Update expenses
            needsExpenses = monthData.needsExpenses || [];
            wantsExpenses = monthData.wantsExpenses || [];

            // Update UI
            renderExpenses(needsList, needsExpenses);
            renderExpenses(wantsList, wantsExpenses);
            calculateAndDisplay(); // This updates budgets, not balance directly
            updateTotals();

            // Update balance with saved savings balance, adding initial salary if it hasn't been added
            const savedBalance = monthData.savingsBalance || 0;
            const initialSalary = monthData.salary || 0;
            // Only add initial salary to balance if balance is 0 (assuming balance is 0 for a new month)
            if (savedBalance === 0 && initialSalary > 0) {
                 balanceSpan.textContent = initialSalary.toFixed(2) + ' ' + (monthlyData[currentMonth]?.currency || 'jd');
                 monthlyData[currentMonth].savingsBalance = parseFloat(balanceSpan.textContent); // Save the initial balance
            } else {
                balanceSpan.textContent = savedBalance.toFixed(2) + ' ' + (monthlyData[currentMonth]?.currency || 'jd');
            }

            withdrawAmountInput.value = '0'; // Clear withdraw input on month change

            // Update currency display
            updateCurrencyDisplay(monthData.currency || 'jd');

            updateHistoryTable();
            updateSavingsGraph();
        }

        // Save current month data
        function saveMonthData() {
            monthlyData[currentMonth] = {
                needsExpenses: needsExpenses,
                wantsExpenses: wantsExpenses,
                salary: parseFloat(salaryInput.value) || 0,
                savingsBalance: parseFloat(balanceSpan.textContent) || 0, // Save the current balance
                currency: monthlyData[currentMonth]?.currency || 'jd' // Save the current currency
            };
            updateHistoryTable();
            updateSavingsGraph();
        }

        function calculateAndDisplay() {
            const salary = parseFloat(salaryInput.value) || 0;
            // The total payout is the initial salary plus any extra payouts added.
            const totalPayout = salary;

            const needs = totalPayout * 0.50;
            const wants = totalPayout * 0.30;
            const savings = totalPayout * 0.20;

            needsHeading.textContent = needs.toFixed(2);
            wantsHeading.textContent = wants.toFixed(2);
            // savingsAmountSpan.textContent = savings.toFixed(2); // This was confusing, removing it

            // TODO: Implement logic to calculate total and left for Needs and Wants
        }

        // Calculate when salary input changes - This now handles initial salary and updates balance
        salaryInput.addEventListener('input', () => {
            const oldSalary = monthlyData[currentMonth]?.salary || 0; // Get salary before change
            const newSalary = parseFloat(salaryInput.value) || 0;
            const salaryDifference = newSalary - oldSalary;

            // Update salary in monthlyData immediately
            monthlyData[currentMonth].salary = newSalary;

            // Add the difference to the balance
            const currentBalanceText = balanceSpan.textContent.replace(/[^0-9.-]+/g, ""); // Remove currency for calculation
            const currentBalance = parseFloat(currentBalanceText) || 0;
            const newBalance = currentBalance + salaryDifference;
            balanceSpan.textContent = newBalance.toFixed(2); // Update only the number
            // currency display is handled by updateCurrencyDisplay for the balance span

            // Recalculate budgets based on new total salary
            calculateAndDisplay();
            updateTotals();
            saveMonthData(); // Save data when salary changes
        });

        // Modified addExtraPayoutButton listener
        addExtraPayoutButton.addEventListener('click', () => {
            const extraAmount = parseFloat(extraPayoutInput.value) || 0;
            if (extraAmount > 0) {
                // Add extra payout to the current month's salary in monthlyData
                monthlyData[currentMonth].salary = (monthlyData[currentMonth].salary || 0) + extraAmount;
                salaryInput.value = monthlyData[currentMonth].salary.toFixed(2);

                // Add extra payout directly to the balance as well
                const currentBalanceText = balanceSpan.textContent.replace(/[^0-9.-]+/g, ""); // Remove currency for calculation
                const currentBalance = parseFloat(currentBalanceText) || 0;
                const newBalance = currentBalance + extraAmount;
                 balanceSpan.textContent = newBalance.toFixed(2); // Update only the number
                 // currency display is handled by updateCurrencyDisplay for the balance span

                calculateAndDisplay(); // Recalculate budgets based on new total salary
                updateTotals(); // Update totals and left amounts
                saveMonthData(); // Save the updated data
                extraPayoutInput.value = '0'; // Clear the extra payout field
            }
        });

        const needsList = document.getElementById('needs-list');
        const wantsList = document.getElementById('wants-list');
        const needsTotalSpan = document.getElementById('needs-total');
        const needsLeftSpan = document.getElementById('needs-left');
        const wantsTotalSpan = document.getElementById('wants-total');
        const wantsLeftSpan = document.getElementById('wants-left');
        const needsExpenseNameInput = document.getElementById('needs-expense-name');
        const needsExpenseAmountInput = document.getElementById('needs-expense-amount');
        const addNeedsExpenseButton = document.getElementById('add-needs-expense');
        const wantsExpenseNameInput = document.getElementById('wants-expense-name');
        const wantsExpenseAmountInput = document.getElementById('wants-expense-amount');
        const addWantsExpenseButton = document.getElementById('add-wants-expense');

        let needsExpenses = [];
        let wantsExpenses = [];

        function renderExpenses(listElement, expenses) {
            listElement.innerHTML = '';
            const currentCurrency = monthlyData[currentMonth]?.currency || 'jd';
            expenses.forEach(expense => {
                const li = document.createElement('li');
                li.textContent = `${expense.name}: ${expense.amount.toFixed(2)} ${currentCurrency}`;
                listElement.appendChild(li);
            });
        }

        function updateTotals() {
            const salary = parseFloat(salaryInput.value) || 0;
            const needsBudget = salary * 0.50;
            const wantsBudget = salary * 0.30;

            const needsTotal = needsExpenses.reduce((sum, expense) => sum + expense.amount, 0);
            const wantsTotal = wantsExpenses.reduce((sum, expense) => sum + expense.amount, 0);

            const currentCurrency = monthlyData[currentMonth]?.currency || 'jd';

            // Update the text content of the amount spans only
            document.getElementById('needs-total').textContent = needsTotal.toFixed(2);
            document.getElementById('wants-total').textContent = wantsTotal.toFixed(2);

            const needsLeft = needsBudget - needsTotal;
            const wantsLeft = wantsBudget - wantsTotal;

            // Update the text content of the amount spans only
            document.getElementById('needs-left').textContent = needsLeft.toFixed(2);
            document.getElementById('wants-left').textContent = wantsLeft.toFixed(2);

             // Update the savings amount display (20% of salary) including currency
            const savingsAmount = salary * 0.20;
            document.getElementById('savings-amount').textContent = savingsAmount.toFixed(2); // Update only the number

            // The balance is updated separately in loadMonthData and event listeners
        }

        function addExpense(type) {
            const nameInput = type === 'needs' ? needsExpenseNameInput : wantsExpenseNameInput;
            const amountInput = type === 'needs' ? needsExpenseAmountInput : wantsExpenseAmountInput;
            const expenseList = type === 'needs' ? needsExpenses : wantsExpenses;
            const listElement = type === 'needs' ? needsList : wantsList;

            const name = nameInput.value.trim();
            const amount = parseFloat(amountInput.value);

            if (name && !isNaN(amount) && amount > 0) {
                expenseList.push({ name, amount });
                // The renderExpenses function now handles placing the currency correctly
                renderExpenses(listElement, expenseList);
                updateTotals();
                saveMonthData();
                nameInput.value = '';
                amountInput.value = '';
            } else {
                alert('Please enter a valid expense name and amount.');
            }
        }

        // Add back the event listeners for the Add Expense buttons
        addNeedsExpenseButton.addEventListener('click', () => addExpense('needs'));
        addWantsExpenseButton.addEventListener('click', () => addExpense('wants'));

        // Initialize everything - loadMonthData will handle initial display
        monthInput.addEventListener('change', loadMonthData); // Use 'change' event for month input
        initializeSavingsGraph();
        initializeMonthInput(); // Call the new initialization function

        // Update history table
        function updateHistoryTable() {
            const historyBody = document.getElementById('history-body');
            historyBody.innerHTML = '';

            Object.entries(monthlyData).forEach(([month, data]) => {
                const row = document.createElement('tr');
                const needsTotal = data.needsExpenses.reduce((sum, exp) => sum + exp.amount, 0);
                const wantsTotal = data.wantsExpenses.reduce((sum, exp) => sum + exp.amount, 0);
                const savings = data.salary - needsTotal - wantsTotal;
                const currency = data.currency || 'jd';

                // Currency is added here in the history table rows
                row.innerHTML = `
                    <td>${month}</td>
                    <td>${data.salary.toFixed(2)} ${currency}</td>
                    <td>${needsTotal.toFixed(2)} ${currency}</td>
                    <td>${wantsTotal.toFixed(2)} ${currency}</td>
                    <td>${savings.toFixed(2)} ${currency}</td>
                `;
                historyBody.appendChild(row);
            });
        }

        // Initialize savings graph
        function initializeSavingsGraph() {
            const ctx = document.getElementById('savingsChart').getContext('2d');
            savingsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Savings Over Time',
                        data: [],
                        borderColor: '#4CAF50',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#ffffff'
                            },
                            grid: {
                                color: '#333'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#ffffff'
                            },
                            grid: {
                                color: '#333'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff'
                            }
                        }
                    }
                }
            });
        }

        // Update savings graph
        function updateSavingsGraph() {
            const months = Object.keys(monthlyData);
            const savingsData = months.map(month => {
                const data = monthlyData[month];
                const needsTotal = data.needsExpenses.reduce((sum, exp) => sum + exp.amount, 0);
                const wantsTotal = data.wantsExpenses.reduce((sum, exp) => sum + exp.amount, 0);
                return data.salary - needsTotal - wantsTotal;
            });

            savingsChart.data.labels = months;
            savingsChart.data.datasets[0].data = savingsData;
            savingsChart.update();
        }

        // Add savings withdrawal section and logic
        withdrawButton.addEventListener('click', () => {
            const withdrawAmount = parseFloat(withdrawAmountInput.value) || 0;
            const currentBalanceText = balanceSpan.textContent.replace(/[^0-9.-]+/g, ""); // Remove currency for calculation
            const currentBalance = parseFloat(currentBalanceText) || 0;

            if (withdrawAmount > 0 && withdrawAmount <= currentBalance) {
                const newBalance = currentBalance - withdrawAmount;
                balanceSpan.textContent = newBalance.toFixed(2); // Update only the number
                // currency display is handled by updateCurrencyDisplay for the balance span
                saveMonthData();
                withdrawAmountInput.value = '0';
            } else if (withdrawAmount > currentBalance) {
                alert('Insufficient funds in savings.');
            } else {
                alert('Please enter a valid amount to withdraw.');
            }
        });

        // Update currency display on the page
        function updateCurrencyDisplay(currency) {
             // Update currency in headings and other general currency spans
             document.querySelectorAll('h2 .currency, .payout-section .currency').forEach(span => {
                  span.textContent = currency;
              });
             // Update currency inside the total/left and balance spans (now in separate spans again)
            document.getElementById('needs-total').nextElementSibling.textContent = currency;
            document.getElementById('needs-left').nextElementSibling.textContent = currency;
            document.getElementById('wants-total').nextElementSibling.textContent = currency;
            document.getElementById('wants-left').nextElementSibling.textContent = currency;
            document.getElementById('balance').nextElementSibling.textContent = currency;
         }

        // Add currency selector
        const currencySelectorDiv = document.createElement('div');
        currencySelectorDiv.classList.add('payout-section'); // Reuse styling
        currencySelectorDiv.innerHTML = `
            <label for="currency-select">Select Currency:</label>
            <select id="currency-select">
                ${availableCurrencies.map(currency => `<option value="${currency}">${currency}</option>`).join('')}
            </select>
        `;
        document.body.insertBefore(currencySelectorDiv, document.querySelector('.container')); // Insert before the main container

        const currencySelect = document.getElementById('currency-select');
        currencySelect.addEventListener('change', (event) => {
            const selectedCurrency = event.target.value;
            monthlyData[currentMonth].currency = selectedCurrency;
            updateCurrencyDisplay(selectedCurrency);
            saveMonthData();
        });

        // Set initial currency display based on loaded data
        updateCurrencyDisplay(monthlyData[currentMonth]?.currency || 'jd');
    </script>
</body>
</html> 